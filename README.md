# Corporate Knowledge Base (RAG) on n8n + Pinecone + Hugging Face

![n8n](https://img.shields.io/badge/n8n-Workflow-orange)
![Pinecone](https://img.shields.io/badge/Pinecone-Vector_DB-blue)
![Hugging_Face](https://img.shields.io/badge/Hugging_Face-E5_Large-yellow)
![Python](https://img.shields.io/badge/Python-3.10+-green)
![Web](https://img.shields.io/badge/Web-Interface-blueviolet)

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ n8n. –†–µ—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Pinecone** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –∏ **Hugging Face Inference API** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –º–æ–¥–µ–ª—å—é `intfloat/multilingual-e5-large`. –í–∫–ª—é—á–∞–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Free Tier —Ç–∞—Ä–∏—Ñ—ã n8n, Pinecone –∏ Hugging Face.
- **–ú–æ–¥–µ–ª—å E5-Large**: –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
- **Batch Processing**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ workflow –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤).
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: `viewer.html` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
- **AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chatbase (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.
- **–£–º–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `config.py` ‚Äî –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `viewer.html` ‚Äî –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- `upload_files_to_pinecone.py` ‚Äî –°–∫—Ä–∏–ø—Ç –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- `search_client.py` - Python –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ Pinecone
- `pinecone_search.py` - CLI –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
- `workflows/` ‚Äî JSON-—Ñ–∞–π–ª—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ n8n
- `data/` ‚Äî –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (`.txt`, `.md`)

---

## üõ† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Workflows

### Workflow 1: –ó–∞–≥—Ä—É–∑–∫–∞ (Upload)
```mermaid
graph LR
    A[Webhook] --> B[Parse Input]
    B --> C[Chunk Text (Loop)]
    C --> D[Aggregate (Batching)]
    D --> E[HTTP Request (HF Inference)]
    E --> F[Code (Merge Vectors)]
    F --> G[Upsert to Pinecone]
    G --> H[Aggregate Results]
    H --> I[Respond to Webhook]
```

### Workflow 2: –ü–æ–∏—Å–∫ (Search)
```mermaid
graph LR
    A[Webhook] --> B[Prepare Query (Add Prefix)]
    B --> C[HTTP Request (HF Embedding)]
    C --> D[Pinecone Query]
    D --> E[Format Results]
    E --> F[Respond to Webhook]
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Python 3.10+ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

### 2. –ò–º–ø–æ—Ä—Ç –≤ n8n
–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `workflows/` –≤ n8n.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Credentials (n8n)

**Hugging Face API** (–≤–º–µ—Å—Ç–æ OpenAI):
- –¢–∏–ø: **Header Auth**
- Name: `Authorization`
- Value: `Bearer hf_xxxxxxxx...` (–í–∞—à —Ç–æ–∫–µ–Ω Hugging Face)
- –ú–æ–¥–µ–ª—å: `intfloat/multilingual-e5-large`

**Pinecone API**:
- –¢–∏–ø: **Pinecone API**
- Value: –í–∞—à API Key.

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.py)
–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Hugging Face:

```python
# –¢–∞–π–º–∞—É—Ç—ã (—É–≤–µ–ª–∏—á–µ–Ω—ã –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ HF)
SEARCH_TIMEOUT = 120
UPLOAD_TIMEOUT = 300

# –ú–æ–¥–µ–ª—å (E5 requires 1024 dimensions)
EMBEDDING_MODEL = "intfloat/multilingual-e5-large"
EMBEDDING_DIMENSION = 1024

# URL –≤–µ–±—Ö—É–∫–æ–≤ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏)
N8N_UPLOAD_WEBHOOK_URL = "https://your-n8n.com/webhook/..."
N8N_SEARCH_WEBHOOK_URL = "https://your-n8n.com/webhook/..."
```

---

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `viewer.html` –≤ –ª—é–±–æ–º –±—Ä–∞—É–∑–µ—Ä–µ:
```bash
# Windows
start viewer.html
# Mac/Linux
open viewer.html
```
- **–ü–æ–∏—Å–∫**: –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∫–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –æ—Ç–ø—É—Å–∫"). –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –ø—Ä–µ—Ñ–∏–∫—Å `query:`.
- **–ß–∞—Ç**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç Chatbase –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –±–∞–∑–µ.

### –í–∞—Ä–∏–∞–Ω—Ç 2: Python CLI

**–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
```bash
python upload_files_to_pinecone.py
```
*–°–∫—Ä–∏–ø—Ç –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ `/data`, —Ä–∞–∑–æ–±—å–µ—Ç –Ω–∞ —á–∞–Ω–∫–∏ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç –≤ Pinecone —á–µ—Ä–µ–∑ n8n.*

**–ü–æ–∏—Å–∫:**
```bash
python pinecone_search.py
```

---

## üîç –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –º–æ–¥–µ–ª–∏ E5
–ú–æ–¥–µ–ª—å —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤. –í –Ω–∞—à–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã: –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `query: `
- –î–æ–∫—É–º–µ–Ω—Ç—ã: –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å (–∏–ª–∏ —Å `passage: ` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

### "–•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç"
–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π API Hugging Face –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å 40-60 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ. –ï—Å–ª–∏ –ø–æ–∏—Å–∫ "–∑–∞–≤–∏—Å" ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å. –¢–∞–π–º–∞—É—Ç—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ —É–≤–µ–ª–∏—á–µ–Ω—ã –¥–æ 120—Å.

---

## üõ† Troubleshooting

**–û—à–∏–±–∫–∞ `Read timed out`**
- –£–≤–µ–ª–∏—á—å—Ç–µ `SEARCH_TIMEOUT` –≤ `config.py`.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ workflow –≤ n8n –∞–∫—Ç–∏–≤–µ–Ω.

**–ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Namespace (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `default`).
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (—Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä–Ω—É–ª `totalUpserted > 0`).

**–ü—Ä–æ–±–ª–µ–º—ã —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º**
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12), —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ—à–∏–±–∫–∏ CORS –∏–ª–∏ —Å–µ—Ç–∏.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –≤–µ–±—Ö—É–∫–∞ –≤ `viewer.html` (–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ JS) —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∞—à–∏–º n8n.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
MIT
